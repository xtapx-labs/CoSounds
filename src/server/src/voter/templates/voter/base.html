{% load django_vite %}
{% load django_htmx %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Vote | Cosound</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <meta name="description" content="A Django project using Tailwind CSS.">
        <meta name="keywords" content="Django, Tailwind, CSS, Python, Web Development">
        <style>
            /* Loader base layout */
            #page-loader {
                position: fixed;
                inset: 0;
                z-index: 9999;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: opacity 0.4s, background-color 0.3s, color 0.3s;
                /* Fallback (will be immediately overridden by media queries in supporting browsers) */
                background: #2a303c;
                color: #d1d5db;
            }

            .loader {
                animation: rotate 1s infinite;
                height: 50px;
                width: 50px;
            }

            .loader:before,
            .loader:after {
                border-radius: 50%;
                content: "";
                display: block;
                height: 20px;
                width: 20px;
            }

            .loader:before {
                animation: ball1 1s infinite;
                background-color: #fff;
                box-shadow: 30px 0 0 #ff3d00;
                margin-bottom: 10px;
            }

            .loader:after {
                animation: ball2 1s infinite;
                background-color: #ff3d00;
                box-shadow: 30px 0 0 #fff;
            }

            @keyframes rotate {
                0% {
                    transform: rotate(0deg) scale(0.8);
                }

                50% {
                    transform: rotate(360deg) scale(1.2);
                }

                100% {
                    transform: rotate(720deg) scale(0.8);
                }
            }

            @keyframes ball1 {
                0% {
                    box-shadow: 30px 0 0 #ff3d00;
                }

                50% {
                    box-shadow: 0 0 0 #ff3d00;
                    margin-bottom: 0;
                    transform: translate(15px, 15px);
                }

                100% {
                    box-shadow: 30px 0 0 #ff3d00;
                    margin-bottom: 10px;
                }
            }

            @keyframes ball2 {
                0% {
                    box-shadow: 30px 0 0 #fff;
                }

                50% {
                    box-shadow: 0 0 0 #fff;
                    margin-top: -20px;
                    transform: translate(15px, 15px);
                }

                100% {
                    box-shadow: 30px 0 0 #fff;
                    margin-top: 0;
                }
            }

            /* Light mode (system preference) */
            @media (prefers-color-scheme: light) {
                #page-loader {
                    background: #f3f4f6;
                    /* light gray */
                    color: #374151;
                    /* slate-700 */
                }
            }

            /* Dark mode (system preference) */
            @media (prefers-color-scheme: dark) {
                #page-loader {
                    background: #1f2733;
                    /* deep slate */
                    color: #d1d5db;
                    /* light gray */
                }
            }

            /* High contrast / forced colors (optional accessibility tweak) */
            @media (forced-colors: active) {
                #page-loader {
                    background: Canvas;
                    color: CanvasText;
                }
            }
        </style>
        <script>
            window.addEventListener("DOMContentLoaded", function() {
                var loader = document.getElementById("page-loader");
                if (loader) {
                    setTimeout(function() {
                        loader.style.opacity = "0";
                        setTimeout(function() {
                            loader.style.display = "none";
                        }, 300);
                    }, 1000); // Show loader for at least 1 second
                }
            });
        </script>
        {% vite_hmr_client %}
        {% vite_asset 'assets/js/main.js' %}
        {% htmx_script %}
    </head>
    <body hx-headers='{"x-csrftoken": "{{ csrf_token }}"}'
          class="flex h-dvh w-full flex-col overscroll-y-none overflow-x-hidden font-sans"
          hx-on:auth-success="window.location.reload()">
        <div id="page-loader">
            <div class="loader" role="status" aria-label="Loading"></div>
        </div>
        <header class="flex w-full flex-row items-center">
        </header>
        <section id="content" class="bg-base flex-1 transition-all duration-300 px-6 ">
            {% block content %}
            {% endblock content %}
        </section>
        <div id="auth-modal"
             class="fixed inset-0 z-50 flex items-end justify-center invisible transition-all duration-300"
             x-data="{ open: false }"
             x-show="open"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             @open-auth-modal.window="open = true; $el.classList.remove('invisible');"
             @close-auth-modal.window="open = false; setTimeout(() => $el.classList.add('invisible'), 200);"
             x-cloak>
            <div class="bg-white dark:bg-gray-800 w-full max-w-lg rounded-t-2xl shadow-2xl transform transition-transform duration-300 overflow-hidden relative"
                 x-show="open"
                 x-transition:enter="translate-y-full"
                 x-transition:enter-end="translate-y-0"
                 x-transition:leave="translate-y-0"
                 x-transition:leave-end="translate-y-full"
                 @click.away="$dispatch('close-auth-modal')">
                <div id="auth-modal-content"
                     class="p-8 min-h-[300px] flex flex-col justify-center transition-all duration-300">
                    <div class="flex justify-center items-center h-full">
                        <div class="loader"></div>
                    </div>
                </div>
                <div id="auth-modal-loader"
                     class="htmx-indicator absolute inset-0 bg-white/80 dark:bg-gray-800/80 z-10 flex items-center justify-center">
                    <div class="loader scale-75"></div>
                </div>
            </div>
        </div>
    </body>
</html>
